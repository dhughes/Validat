<?xml version="1.0" encoding="iso-8859-1"?>

<!--
    validat.xml
	
    Description:
        This is the configuration xml that is passed to the validat object upon instantiation and includes
        definitions for all of the validation rules and data sets that the validation engine will handle.  This
        configuration file may also be extended through the include tag, in which case the configuration included
        in this file will be loaded first, then the configuration information in each include file will be loaded
        (top to bottom priority) with any duplicate rules or data sets overriding a previous configuration.
-->

<validat>

	<!-- Additional configuration information can be included from other files and validation rules or data sets 
		that have name conflicts will overwrite the previous value -->
	<include template="extendedRules.xml" />

	<!-- validation rule definitions -->
	<validationRules>
		
		<!-- Each validation rule is specified with a unique name and its associated validator object bean name.
			A validation rule may also contain additional detail arguments to be passed into the validate function 
			along with the data value to be validated. -->

		<rule name="alpha" validator="validateAlpha" />
		<rule name="alphaNumeric" validator="validateAlphaNumeric" />
		<rule name="birthdate" validator="validateBirthDate" >
			<arg name="min" default="0" />
			<arg name="max" default="120" />
		</rule>
		<rule name="creditCard" validator="validateCreditCard" />
		<rule name="duplicatePerson" validator="validateDuplicatePerson" />
		<rule name="length" validator="validateLength">
			<arg name="min" default="0" />
			<arg name="max" default="100" />
		</rule>
		<rule name="ssn" validator="validateSSN" />
		
	</validationRules>
	
	<!-- data set definitions -->
	<dataSets>
	
		<!-- A data set groups a set of assertions and data elements together and specifies the transformer object 
			(which adhears to the transformer interface) name that is utilized to retreive data from the data 
			collection. The specified data transformer will refer to the bean name of an object that implements
			the transformer interface.  This transformer object will be able to accept the data collection for
			the given data set and return a collection of key / value pairs that may be passed to an given
			validator.  The generic structure and generic bean transformers are built into the framework and do
			not need to be specified in the data set definition. -->

		<dataSet name="user" transformer="transformStruct">

			<!-- A data element represents a specific data value that can be requested by name from the transformer
				object for this data set.  The data element's name attribute will be passed to the transformer 
				object to retrieve the data value to be validated.  The required attribute for the data element 
				indiciates whether the data value is required (true / false) or optional.
				
				- If the required attribute is TRUE, then all assertions within the data element will be evaluated.
				- If the required attribute is FALSE, then the assertions within the data element will be evaluated
					only if the data value is not an empty string.  If the data value is an empty string, none of
					the assertions will be evaluated.
				- If the required attribute is OPTIONAL, then none of the assertions within the data element will
					be evaluated.
				
				If the required attribute is true, then an additional message attribute for the data element should
				be provided and will contain the error message to be returned if the data value is an empty string.
				
				A data element may contain one or more assertions or a single data set.
				
				An assertion corresponds to a specific, previously defined, validation rule.  When defined within a 
				data element, the assert element then contains a collection of optional argument and message elments.
				The argument elements, of which there may be none, will be passed to the validator associated with
				the validation rule along with the value of the parent data element.  The validator will then return
				true if the validation succeeds, or it will return a message name which should correspond to a 
				message element within the assert element.  The validation engine will store the corresponding
				message value in the error collection that is returned.
				
				An assert element may also have an optional continueOnFail attribute, which if not provided, defaults
				to false.  This attribute instructs the validation engine to continue, or not, processing additional
				assertions if the current assertion has failed.
				
				When defined within a data element, the data set element signifies that the data element value is
				a complex value (structure, object, etc.) and not a simple string value.  The validation engine will
				then recursively call the validate method again, passing this complex data value along with the
				specified data set name.  Upon validation, it will concatenate the resulting error collection with
				the error collection for the current validation process. -->

			<dataElement name="prefix" required="false" >
				<assert rule="prefix" >
					<!-- the message name must correspond to the value returned upon validation failure from the
						validator object -->
					<message name="invalid" value="errors.validation.user.prefix.invalid" />
				</assert>
			</dataElement>
			<dataElement name="firstName" required="true" message="errors.validation.user.firstName.required" >
				<assert rule="length" >
					<!-- optionally, additional arguments can be provided to the validator function -->
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.firstName.invalidLength" />
				</assert>
			</dataElement>
			<dataElement name="middleName" required="false" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.middleName.invalidLength" />
				</assert>
			</dataElement>
			<dataElement name="lastName" required="true" message="errors.validation.user.lastName.required" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.middleName.invalidLength" />
				</assert>
			</dataElement>
			<dataElement name="suffix" required="false" >
				<assert rule="suffix" >
					<message name="invalid" value="errors.validation.user.suffix.invalid" />
				</assert>
			</dataElement>
			<dataElement name="birthDate" required="true" message="errors.validation.user.birthdDate.required" >
				<assert rule="birthdate" >
					<message name="invalid" value="errors.validation.user.birthdate.invalid" />
				</assert>
			</dataElement>
			<dataElement name="ssn" required="true" message="errors.validation.user.ssn.required" >
				<assert rule="ssn" >
					<message name="invalid" value="errors.validation.user.ssn.invalid" />
				</assert>
			</dataElement>

		</dataSet>
			
		<dataSet name="person" transformer="transformPerson">
		
			<!-- In addition to data elements, a data set may also contain "global" assertions that apply to more
				than one data element.  Similar to data element assertions, global assertions still correspond to
				a specific, previously defined, validation rule.  Along with any other arguments, a global 
				assertion should provide as arguments the data element pointer for the data element values that
				neccessary in the associated validator. -->

			<assert rule="duplicatePerson" >
				<arg name="firstName" value="firstName" />
				<arg name="lastName" value="lastName" />
				<arg name="emailAddress" value="emailAddress" />
				<message name="failByEmail" value="errors.validation.person.duplicate.email" />
				<message name="failByName" value="errors.validation.person.duplicate.name" />
			</assert>

			<dataElement name="firstName" required="true" message="errors.validation.user.firstName.required" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.firstName.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="middleName" required="false" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.middleName.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="lastName" required="true" message="errors.validation.user.lastName.required" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.user.middleName.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="billingAddress" required="true" message="errors.validation.person.billingAddress.required" >
				<dataSet name="address" />
			</dataElement>

			<dataElement name="mailingAddress" required="true" message="errors.validation.person.mailingAddress.required" >
				<dataSet name="address" />
			</dataElement>

			<dataElement name="emailAddress" required="true" message="errors.validation.person.emailAddress.required" >
				<assert rule="emailAddress" continueOnFail="true" >
					<message name="invalid" value="errors.validation.person.emailAddress.invalid" />
				</assert>
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.person.emailAddress.invalidLength" />
				</assert>
			</dataElement>
			
		</dataSet>
		
		<dataSet name="address" transformer="trasnformAddress" >
			
			<assert rule="state" >
				<arg name="state" value="state" />
				<arg name="country" value="country" />
				<message name="required" value="errors.validation.address.state.required" />
				<message name="invalid" value="errors.validation.address.state.invalid" />
			</assert>

			<dataElement name="street1" required="true" message="errors.validation.address.street1.required" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.address.street1.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="street2" required="false" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.address.street2.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="city" required="true" message="errors.validation.address.city.required" >
				<assert rule="length" >
					<arg name="min" value="1" />
					<arg name="max" value="100" />
					<message name="invalid" value="errors.validation.address.city.invalidLength" />
				</assert>
			</dataElement>

			<dataElement name="postalCode" required="true" message="errors.validation.address.postalCode.required" >
				<assert rule="postalCode" >
					<message name="invalid" value="errors.validation.address.postalCode.invalid" />
				</assert>
			</dataElement>

			<dataElement name="country" required="true" message="errors.validation.address.country.required" >
				<assert rule="country" >
					<message name="invalid" value="errors.validation.address.country.invalid" />
				</assert>
			</dataElement>
			
		</dataSet> 

	</data>
	
</validat>		
